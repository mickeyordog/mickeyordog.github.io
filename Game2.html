<!DOCTYPE html>
<html>
<head>
  <title>Game 2</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    .button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      justify-content: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 20px;
      border: 2px solid #555555;
      transition-duration: 0.4s;
      /*display: block;*/
    }
    .button:hover {
      background-color: white;
      color: black;
    }
  </style>
</head>
<body onload="startGame()">
  <script>

    var myScore;
    var cookies = 0;
    var cookieRate = 0;
    var clickRate = 1;
    var frameNo = 0;

    function Producer(label, price, increase, type) {
      this.label = label;
      this.price = price;
      this.increase = increase;
      this.type = type; // 0 increases per second, 1 increases per click
      this.button = document.createElement("button");
      this.p = document.createElement("p");
      this.number = 0;
      this.purchase = function() {
        if (cookies >= this.price) {
          if (this.type == 0) {
            increaseRate(this.increase);
          } else {
            increaseClickRate(this.increase);
          }
          cookies -= this.price;
          this.number++;
          this.p.innerHTML = this.label + ": " + this.number;
          this.price = Math.floor(this.price * 1.2);
          this.updateLabel();
        }
      }
      this.updateLabel = function(){
        let label2 = (this.type == 0) ? "CPS": "CPC";
          this.button.innerHTML = this.label + " (+" + this.increase + " " + label2 + ")" + "<br>" + this.price + " Cookies";
      }
    }

    var producers = [
      new Producer("Buy Autoclick", 5, 1, 1),
      new Producer("Buy Oven", 10, 1, 0),
      new Producer("Hire Grandma", 50, 3, 0),
      new Producer("Build Factory", 100, 7, 0),
      new Producer("Plant Cookie Trees", 200, 20, 0),
      new Producer("Found Cookie Kingdom", 500, 70, 0),
      new Producer("Create Cookie Planet", 1000, 120, 0)
    ];

    function startGame() {
      window.setInterval(updateGame, 20);

     // var body = document.getElementsByTagName("body")[0];
     var body = document.getElementById("myDiv");
     var body2 = document.getElementById("div2");
      producers.forEach(function(producer) {
        producer.updateLabel();
        body.appendChild(producer.button);
        body2.appendChild(producer.p);
        producer.button.classList.add("button");
        producer.button.style.display = "none";
        producer.button.addEventListener ("click", function() {
          producer.purchase()});
      })
    }

    function updateGame() {
      frameNo ++;
      /*if (everyinterval(10)) {
        //50 is every second
        cookies += cookieRate * .2;
      }*/
      cookies += cookieRate * .02;
      document.getElementById("counter").innerHTML = "Cookies: " + Math.floor(cookies);
      if (cookies > 10000)
        document.getElementById("winText").innerHTML = "You win! You are the cookie master!"
    
      producers.forEach(function(producer) {
        if (producer.button.style.display === "none" && cookies > producer.price) {
          producer.button.style.display = "block";
        }
      })
    }

    function everyinterval(n) {
      if ((frameNo / n) % 1 == 0) {
        return true;
      }
      return false;
    }

    function increaseRate(amount) {
      cookieRate += amount;
      document.getElementById("cps").innerHTML = "Cookies/sec: " + Math.floor(cookieRate);
    }
    function increaseClickRate(amount) {
      clickRate += amount;
      document.getElementById("clickRate").innerHTML = "Cookies/click: " + Math.floor(clickRate);
    }
    function addCookies() {
      cookies += clickRate;
    }

  </script>
  <div style="text-align:center;width:480px;">
    <br><button class="button" onmousedown="addCookies()" ontouchstart="addCookies(1)">Click 4 Cookie</button><br><br>
    
  </div>
  <div id="div2" style="text-align:center;width:480px;">
    <p id="counter">
      Cookies: 0
    </p>
    <p id="clickRate">
      Cookies/click: 1
    </p>
    <p id="cps">
      Cookies/sec: 0
    </p>
    <p>
      CPS = cookies per second, CPC = cookies per click
    </p>
    <p>
      What will happen when you reach 10,000?
    </p>

    <p id="winText"></p>
  </div>
  <div id="myDiv" style="text-align:center;width:480px;"></div>
</body>
</html>